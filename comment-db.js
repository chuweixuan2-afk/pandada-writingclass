// 统一评语库与智能评语生成逻辑
// 覆盖一～三年级所有课程；支持“同字不同评”（按年级 + 课次）

(function () {
    // ===== 1. 主评语库：以 class3.html 中的最新版为基础 =====
    window.COMMENT_DB = {
        openings: {
            fast: [
                "下笔很果断嘛！但我发现你写得稍微快了点，",
                "笔势非常流畅，行云流水，不过潘哒哒建议慢一点，",
                "速度不错，很有自信！如果能在这个基础上多留意一下细节，",
                "哇，这么快就写好了！让我来看看细节处理得怎么样，"
            ],
            normal: [
                "这一遍写得很稳，潘哒哒扫描到了好几个亮点！",
                "整体字形端正，我看你这一笔一划都用了心，",
                "节奏控制得很好，不急不躁，这正是练好字的关键。",
                "看来你已经掌握了字的重心，第一眼看过去很舒服，"
            ],
            slow: [
                "凝神静气，我能感觉到你写这一笔时的专注，",
                "沉稳是好事，每一笔都写得很扎实，",
                "经过深思熟虑的一笔，虽然慢但结构立住了，",
                "很认真！这种一丝不苟的态度，潘哒哒非常欣赏，"
            ]
        },
        structure: {
            // === 三年级 第一课 ===
            three_pie: [
                "三撇要做到<b>‘间距均匀’</b>，就像排队一样整齐。",
                "三撇的起笔要<b>‘上下对正’</b>，气脉连贯。",
                "最后一撇写得<b>‘长且稍立’</b>，支撑起左边的结构。"
            ],
            qian_zi: [
                "欠字旁要有精神，第一撇<b>‘起笔高且稍立’</b>。",
                "横钩要写得<b>‘窄小’</b>，撇收捺放，<b>‘向右伸展’</b>。",
                "左右结构要<b>‘穿插避让’</b>，欠字旁的撇画往往伸向左边部件下方。"
            ],
            ye_zi: [
                "页字旁要写得<b>‘垂直挺拔’</b>，像站立的士兵。",
                "下面的撇画要<b>‘内插稍立’</b>，最后一点<b>‘稍大有力’</b>。",
                "首横稍长，盖住下面的部件，重心平稳。"
            ],

            // === 三年级 第二课 ===
            zi_zi: [
                "写子字旁时，要把它写得<b>‘整体瘦长’</b>，就像个站得直直的小朋友。",
                "注意那个弯钩，<b>‘弧度要小’</b>，出钩也要短小有力，不能写得太软。",
                "最关键的一笔是‘提’，要做到<b>‘左放右收’</b>，起笔靠左，收笔要干脆，给右边的字腾出空间。"
            ],
            gong_zi: [
                "弓字旁也是个瘦高个，整体要<b>‘微向左斜’</b>，保持一种动态的美感。",
                "写竖折折钩时要注意，行笔要有<b>‘弧度’</b>，不能写得直愣愣的，这样字才生动。"
            ],
            ma_zi: [
                "马字旁要写得<b>‘瘦长’</b>，稍微向左倾斜一点点。",
                "最后一笔‘提’，要向<b>‘左边伸展’</b>，起笔有力，气势要足。"
            ],

            // === 三年级 第三课 ===
            you_zi: [
                "写酉字旁时，要把它写成一个<b>‘长方形’</b>，下面的两条竖画要写直。",
                "注意观察里面的短横，它们和上下的间距要做到<b>‘匀称’</b>，不能挤在一起。",
                "记住一个小秘密：酉字旁里的竖弯是<b>‘没有钩’</b>的，收笔要干脆。"
            ],
            mi_zi: [
                "米字旁的主心骨是中间的竖，要写得<b>‘高而直’</b>。",
                "注意点和撇的关系，左边的点低，右边的撇高，它们要<b>‘左右呼应’</b>。",
                "最关键的细节：中间的竖画是穿过短横的<b>‘右侧’</b>，不是正中间哦。"
            ],
            fang_zi: [
                "方字旁很有个性，整体体态要<b>‘略微倾斜’</b>。",
                "第一笔点要<b>‘靠里’</b>写，横画要向上斜，这样字才显得精神。",
                "最难写的横折钩，挑钩的地方是最低点，而且要和第一笔点在一条<b>‘竖中线’</b>上。"
            ],

            // === 三年级 第四课 ===
            chun_zi: [
                "这一课的字都要做到<b>‘上盖下’</b>，上面的撇和捺要写得像一把大伞，把下面的部分完全罩住。",
                "注意观察横画，不管是三横还是两横，都要写得<b>‘短而紧凑’</b>，而且微微向上倾斜，间距要均匀。",
                "撇画起笔要高，捺画起笔稍低，两笔都要<b>‘舒展大方’</b>，这样字才显得大气。"
            ],
            fu_zi: [
                "写父字头时，要注意<b>‘撇低点高’</b>，左边的撇低，右边的点高，这叫左右呼应。",
                "撇和捺的交点位置要<b>‘偏上’</b>，留出足够的空间给下面的部件。"
            ],

            // === 三年级 第五课 ===
            upDown_wideTop: [
                "写上下结构的字，最重要的就是<b>‘重心对正’</b>，上下的中心线要连成一条直线。",
                "像这种<b>‘上宽下窄’</b>的字，上面要写得舒展，像一把伞盖住下面。"
            ],
            upDown_wideBottom: [
                "这是典型的<b>‘上窄下宽’</b>，上小下大，像一座稳固的金字塔。",
                "注意上下两部分的<b>‘连接紧凑’</b>，不能离得太远，要像积木一样咬合在一起。"
            ],
            upDown_skew: [
                "虽然某一部分是斜的，但通过笔画的调节，让整个字的重心依然保持正直，这叫<b>‘斜中取正’</b>。",
                "注意观察上下部件的<b>‘对正’</b>关系，虽然斜但不能倒。"
            ],

            // === 三年级 第六课 ===
            upMidDown_general: [
                "写上中下结构的字，最大的忌讳就是写得太长！三层楼盖起来，每层都要<b>‘写扁’</b>一点。",
                "注意横向笔画之间的距离要<b>‘压缩’</b>，紧紧凑在一起，这样字才稳当。"
            ],
            upMidDown_wideMid: [
                "这个字<b>‘中间宽’</b>！中间的主笔（如撇捺）写得非常舒展，像手臂一样张开。",
                "上下两部分都要写得<b>‘扁平’</b>，收敛一点，把舞台让给中间。"
            ],
            upMidDown_wideBottom: [
                "这个字是<b>‘下边宽’</b>，最下面的横画（或竖钩）写得长长的，托住了上面所有的重量。",
                "中间的部分要写<b>‘扁’</b>，不能写成方方正正的，否则字就太高了。"
            ],
            upMidDown_wideTop: [
                "这个字<b>‘上边宽’</b>，第一横（或宝盖头）写得长而平，盖住了下面的部分。",
                "虽然头大身子小，但因为<b>‘中轴线对正’</b>，所以看起来很端庄。"
            ],
            upMidDown_equal: [
                "这个字三部分高度差不多，但上部要写得<b>‘窄小’</b>。",
                "整体<b>‘上紧下松’</b>，上面收得紧，下面放得开。"
            ],
            upMidDown_wideEnds: [
                "这个字像个<b>‘细腰’</b>的美女。上下都比较宽，中间写得窄而扁。",
                "上下两部分的主笔<b>‘互相呼应’</b>，把字撑开了，很有韵味。"
            ],

            // === 三年级 第七课 ===
            surround_leftUp_G3: [
                "外框的撇画是关键！要写得<b>‘舒展、修长’</b>，像长长的手臂一样护住里面的部分。",
                "被包围的部分要<b>‘稍向右移’</b>，不能缩在角里，要大大方方地露出来，保持重心的平衡。"
            ],
            surround_rightUp_G3: [
                "主笔通常是右边大大的<b>‘斜钩’</b>或<b>‘横折钩’</b>，一定要写得气势开张。",
                "里面的部件要<b>‘靠左、靠上’</b>，给右边的钩画留出足够的表演空间，不能挤在一起。"
            ],
            surround_leftDown_G3: [
                "写好这类字，全靠下面的一笔<b>‘捺’</b>！捺画要平而长，像一只小船稳稳托住上面的货物。",
                "里面的部分要写得<b>‘紧凑、偏高’</b>，不能掉在捺画的尾巴上。"
            ],

            // === 三年级 第八课 (v23.3 新增) ===
            surround_left3_G3: [
                "写这种左包右的字，记住<b>‘上横短，下横长’</b>。下面的横画要向右伸展，托住里面的部件。",
                "里面的部件要<b>‘贴左书写’</b>，不要离左边的墙太远，这样结构才紧凑。"
            ],
            surround_top3_G3: [
                "写门字框，关键是<b>‘左短右长’</b>。左边的竖画稍短，右边的竖画稍长且带钩。",
                "里面的部件要<b>‘居中’</b>，四周留有空隙，不能挤到门框上。"
            ],
            surround_bottom3_G3: [
                "这一类字下面的框要写得<b>‘宽而稳’</b>。",
                "两侧的竖画要<b>‘稍向内收’</b>（或垂直），如果向外倒，字就散了。"
            ],
            surround_full_G3: [
                "大口框要写得<b>‘方正饱满’</b>，两边的竖画要像柱子一样直（或微向内抱）。",
                "里面的部件要<b>‘居中’</b>，大小适中，既不能填满，也不能太小。"
            ],

            // === 基础通用 (一、二年级) ===
            upDown_cover: [
                "上面的偏旁写得宽，下面的部分写得窄，这就是标准的<b>‘上宽盖下’</b>。",
                "上下的中心线对得很正，做到了<b>‘重心平稳’</b>，字没有倒。",
                "字头收紧，下部舒展。你注意到了<b>‘上收下放’</b>的节奏感。"
            ],
            leftRight_narrowAvoid: [
                "虫字旁和车字旁作为左偏旁时，都要写得<b>‘偏旁窄长’</b>，给右边的主体留出位置。",
                "最关键的一笔是‘提’，要做到<b>‘提左伸右缩’</b>，左边伸出去平衡重心，右边收住不碰到右边部件。"
            ],
            surround_leftUp_bing: [
                "病字旁是典型的左上包围，要注意<b>‘左包右探’</b>，被包围的部分不要缩在里面，要适当向右伸展。",
                "病字旁的撇画要写得<b>‘长而舒展’</b>，像长长的手臂一样护住里面的部分。"
            ],
            surround_bao: [
                "写包字头时，横折钩的竖画要<b>‘向里包裹’</b>，不能写直了，这样才有把东西‘包住’的感觉。",
                "注意内部部件的位置，要做到<b>‘内部偏左’</b>，给右边的钩画留出空间。"
            ],
            leftRight_narrowLong: [
                "这一课的偏旁都要写得<b>‘形状窄长’</b>，就像瘦高个一样，不要写胖了。",
                "左边的偏旁写得收敛，符合<b>‘左窄右宽’</b>的审美标准。",
                "注意看提画，起笔要低，<b>‘提左伸’</b>，向左延伸去寻找平衡。",
                "最关键的细节你做到了：<b>‘提不穿过右竖’</b>！提画的尾巴收得干脆。"
            ],
            surround_guo: [
                "记住<b>‘外框大小看里面’</b>的要诀！里面的部分如果大，外框就要写大。",
                "外框的两根竖画写得<b>‘左右竖挺直’</b>，就像房子的柱子一样，支撑起了整个字。",
                "注意到了吗？左边的竖画通常要比右边的<b>‘稍短’</b>，这叫‘左短右长’。",
                "整体来看，外框在田字格里<b>居中</b>，占格非常标准。"
            ],
            surround_men: [
                "门字框写得<b>‘左右竖挺直’</b>，像两扇大门一样立在那里。",
                "很好的习惯！你把被包围的部分写得<b>‘稍靠上’</b>，没有掉在底边上，这让整个字看起来很透气。"
            ],
            surround_san: [
                "这个字体现了三框结构<b>‘上横上扬’</b>的特点，第一笔横画写得很有姿态。",
                "底部的横画写得<b>‘下横平稳’</b>且稍长，托住了整个字。"
            ],
            leftRight_interlace: [
                "这才是高手！我看到左边部件的笔画，巧妙地<b>插到了</b>右边部件的空隙里，这就叫<b>‘左右穿插’</b>！",
                "左右两部分配合得太默契了，结构非常<b>紧凑</b>。",
                "注意到了吗？为了不和右边‘打架’，你把左边的捺画改成了点（或缩短了），这叫<b>‘避让’</b>。"
            ],
            leftRight_equal: [
                "注意哦！这个字不是左窄右宽，而是<b>“左右等宽”</b>，你处理得非常准确。",
                "左右两边各占一半，虽然平分秋色，但依然有着紧密的<b>穿插</b>关系。"
            ],
            leftRight_narrowWide: [
                "整体结构把握得很好！<b>左边写得窄窄的</b>，把宽敞的空间都让给了右边。",
                "你抓住了左右结构的精髓！左边的偏旁像是‘绿叶’，写得收敛；右边的主体像是‘红花’，写得舒展。"
            ],
            leftRight_lowHigh: [
                "你处理出了<b>‘左低右高’</b>的感觉，非常有动感，这是这个字独有的特点！"
            ],
            leftUpperWrap: [
                "对于这种<b>左上包围</b>的字，你很好地做到了<b>‘左包右放’</b>！",
                "外部的框没有写得太宽，让里面的字<b>‘露头露脚’</b>，这样整个字才显精神。"
            ],
            general: [
                "整个字的<b>重心</b>找得很准，没有歪倒。",
                "笔画之间的<b>呼应关系</b>处理得很妙，气脉连贯。",
                "整体<b>中宫收紧</b>，四肢舒展，很有大家风范。"
            ]
        },
        // 详情：这里先只放三年级和部分二年级，后面再补充一、二年级的扩展
        details: {
            // === 三年级 第一课 (id:21) ===
            "杉": [
                "左边的三撇旁写得真棒，做到了<b>‘三撇间距均匀’</b>，非常有节奏感！",
                "注意到了吗？三撇旁的最后一撇<b>‘长且稍立’</b>，这就是这个偏旁的精神所在。",
                "结构把握得很好！左右两边<b>‘宽度相等’</b>，而且左边短、右边长，错落有致。",
                "右边的‘木’字撇捺舒展，和左边的三撇旁互相呼应，<b>‘左右等宽’</b>处理得很完美。"
            ],
            "影": [
                "左边的‘景’字写得很好，横画虽多但<b>‘间距相等’</b>，看起来非常整洁。",
                "整体结构控制得当，左边宽、右边窄，符合<b>‘左宽右窄’</b>的结字规律。",
                "右边的三撇很有动感，上下对正，为整个字增添了飘逸的感觉。",
                "左边‘景’字底部的‘小’字没有写得太散，很好地<b>托住了上面</b>的‘日’和‘京’。"
            ],
            "欧": [
                "右边欠字旁的<b>‘首撇起笔高’</b>，一下子就把字的精气神提起来了！",
                "最关键的一笔处理得很棒：欠字旁的<b>‘横钩窄小’</b>，没有写得太宽。",
                "这才是点睛之笔！最后一笔<b>‘捺向右伸展’</b>，让整个字看起来非常舒展。",
                "结构满分！左边的‘区’写得收敛，右边舒展，体现了<b>‘左短右长、左右穿插’</b>的技巧。"
            ],
            "欣": [
                "整体结构非常平衡，左右两边<b>‘基本等宽’</b>，谁也不抢谁的地盘。",
                "细看你的字，右边的欠字旁比左边的‘斤’<b>‘稍高一点’</b>，这让字形更生动。",
                "左边的‘斤’字首撇写得较平，竖撇<b>‘先直后弯’</b>，线条很有韧性。",
                "左右两部分结合紧密，欠字旁的撇画<b>穿插</b>到了左边，没有分家。"
            ],
            "预": [
                "页字旁写得非常规范！首横稍长，两侧的竖画<b>‘垂直挺拔’</b>。",
                "注意看页字旁下面，撇画做到了<b>‘内插稍立’</b>，最后一点收笔很有力！",
                "左右两边的横画<b>‘斜度一致’</b>，这让整个字看起来非常协调统一。",
                "结构上做到了<b>‘左右等宽’</b>，左边的‘予’和右边的‘页’配合默契。"
            ],
            "颗": [
                "左边的‘果’字写得真好，尤其是中间的横画，<b>‘间距紧凑’</b>而不拥挤。",
                "左右两部分<b>‘宽度相等’</b>，整体显得端庄大方。",
                "页字旁写得正气凛然，<b>‘点画有力’</b>，支撑起了半边天。",
                "‘果’字的撇捺变成了点，这种<b>‘避让’</b>处理得非常专业！"
            ],

            // === 三年级 第二课 (id:22) ===
            "孔": [
                "子字旁写得真棒，特别是‘提画’做到了<b>‘左放右收’</b>，非常有礼貌地避让了右边。",
                "右边的竖弯钩写得舒展，起笔比左边<b>‘稍高’</b>，整个字非常有精神。",
                "整体做到了<b>‘左低右高’</b>，而且左边窄右边宽，结构非常标准。"
            ],
            "孤": [
                "子字旁保持了<b>‘瘦长’</b>的体态，弯钩写得很有力度。",
                "右边的‘瓜’字写得好，笔画虽然多，但你处理得<b>‘非常紧凑’</b>，没有散架。",
                "这一笔一划体现了<b>‘左窄右宽’</b>的规律，左右两部分配合得很默契。"
            ],
            "弹": [
                "弓字旁写得小巧，竖折折钩的<b>‘弧度’</b>控制得很好，很有弹性。",
                "右边的‘单’字写得真稳，特别是中间的横画，<b>‘间距均匀’</b>，看起来非常整洁。",
                "整体结构是<b>‘左窄右宽’</b>，下面微微向左倾斜，动感十足。"
            ],
            "引": [
                "这个字很特别哦！弓字旁在这里是主角，占的位置比较<b>‘宽’</b>。",
                "右边的竖画写得<b>‘垂直伸展’</b>，像一根柱子一样立住了整个字。",
                "注意到了吗？这个字是<b>‘左宽右窄’</b>，和别的左右结构字不一样，你观察得真仔细！"
            ],
            "验": [
                "马字旁的提画向<b>‘左边伸展’</b>，起笔的位置处理得很棒。",
                "右边的部分写出了层次感，上面的人字头<b>‘盖住’</b>了下面的部分，结构很稳。",
                "整体是标准的<b>‘左窄右宽’</b>，马字旁瘦长，右边宽舒，搭配得很完美。"
            ],
            "骗": [
                "马字旁写得<b>‘瘦长微斜’</b>，竖折折钩的转折很有力度。",
                "右边的‘扁’字处理得很好，上面写得窄，下面写得宽，<b>‘上窄下宽’</b>才站得稳。",
                "左右结构紧凑，体现了<b>‘左窄右宽’</b>的特点，看起来非常大气。"
            ],

            // === 三年级 第三课 (id:23) ===
            "配": [
                "酉字旁写得<b>‘长方端正’</b>，第一笔横画较长，盖住了下面的部分。",
                "右边的竖弯钩写得非常舒展，向右<b>‘伸展’</b>出去，托住了整个字的右半边。",
                "左右配合得很好，<b>‘左窄右宽’</b>，左边紧凑，右边舒展，结构满分。"
            ],
            "酷": [
                "酉字旁内部处理得很棒，<b>‘笔画紧凑’</b>，而且竖弯确实没有写钩，观察很仔细。",
                "右边的‘告’字，‘口’写得扁扁的，上面的撇画<b>‘靠上’</b>，没有掉下来。",
                "整体做到了<b>‘左窄右宽’</b>，左右两部分靠得很紧，没有分家。"
            ],
            "粒": [
                "米字旁写得真好，点和撇做到了<b>‘左右呼应’</b>，非常生动。",
                "右边的‘立’字站得很稳，点画和长横配合得当。",
                "注意到了吗？这个字呈现出<b>‘左高右低’</b>的姿态，非常有层次感。"
            ],
            "料": [
                "米字旁的竖画挺拔，而且注意了<b>‘竖穿短横右侧’</b>的细节，非常专业。",
                "右边的‘斗’字，两点上下对齐，竖画<b>‘长而直’</b>，很有力量。",
                "左右两部分<b>‘穿插’</b>得很好，米字旁的捺变点，给右边留出了位置。"
            ],
            "放_G3L23": [
                "方字旁写出了<b>‘形体略斜’</b>的感觉，特别是横折钩向左斜，很有动感。",
                "右边的反文旁撇捺舒展，特别是捺画，向右<b>‘伸展’</b>，很大气。",
                "左右两部分<b>‘互相穿插’</b>，方字旁的点和右边的撇互相避让，配合默契。"
            ],
            "放": [
                "这个字是<b>“左右等宽”</b>。",
                "方字旁<b>重心偏右</b>。",
                "反文旁<b>撇稍立</b>，穿插紧凑。"
            ],
            "施": [
                "方字旁的第一点<b>‘靠里’</b>，定住了重心，横画上斜，气势很足。",
                "右边的‘也’字写得真棒，特别是竖弯钩<b>‘向右伸展’</b>，拉开了整个字的架势。",
                "标准的<b>‘左窄右宽’</b>，方字旁收敛，‘也’字舒展，一收一放，非常漂亮。"
            ],

            // === 三年级 第四课 (id:24) ===
            "泰": [
                "上面的三横写得真好，<b>‘短且平行’</b>，间距控制得非常均匀。",
                "撇和捺非常<b>‘舒展’</b>，完全盖住了下面的‘水’字，气势很足。",
                "整体做到了<b>‘上宽下窄’</b>，重心平稳，非常有大家风范。"
            ],
            "奉": [
                "上面的三横处理得很有水平，<b>‘微上斜’</b>且间距匀称，看起来很整洁。",
                "撇捺打开，形成了<b>‘上宽下窄’</b>的漂亮结构。",
                "最关键的一笔写对了！最后一笔是<b>‘悬针竖’</b>，垂直挺拔，没有写成钩，非常专业！"
            ],
            "拳": [
                "上面的两点做到了<b>‘左右呼应’</b>，点低撇高，很有神采。",
                "撇画写得<b>‘长而稍立’</b>，捺画伸展，搭起了整个字的骨架。",
                "上下结合紧密，<b>‘上盖下’</b>的特点表现得很到位。"
            ],
            "眷": [
                "上半部分写得<b>‘宽敞舒展’</b>，特别是那个长撇，起笔很有力。",
                "下面的‘目’字写得<b>‘瘦长紧凑’</b>，横画之间的距离控制得非常紧密。",
                "标准的<b>‘上宽下窄’</b>，上面像大屋顶，下面像稳固的墙，结构很棒。"
            ],
            "爹": [
                "父字头写得生动，撇和点<b>‘左右呼应’</b>，位置安排得当。",
                "撇捺<b>‘舒展’</b>，像父亲宽厚的肩膀一样，罩住了下面的部分。",
                "下面的‘多’字处理得很好，两个‘夕’字高低错落，而且<b>‘上小下大’</b>，重心很稳。"
            ],
            "斧": [
                "父字头的撇捺开张，为下面的字留出了<b>‘宽敞’</b>的空间。",
                "下面的‘斤’字写得挺拔，特别是最后一笔竖画，<b>‘向下伸展’</b>，拉长了整个字的身形。",
                "注意到了吗？最后一笔是<b>‘竖’</b>，你写得很直，支撑力很强。"
            ],

            // === 三年级 第五课 (id:25) ===
            "夺": [
                "大字头的撇和捺写得非常<b>‘舒展’</b>，长度均匀对等，像翅膀一样张开。",
                "注意横画要写得<b>‘短而有力’</b>，给撇捺留出发挥的空间。",
                "下面的‘寸’字写得<b>‘端正’</b>，竖钩正好在字的中心线上，重心很稳。"
            ],
            "吴": [
                "上面的‘口’字写得<b>‘小而偏上’</b>，呈倒梯形，非常精神。",
                "下面的撇捺非常舒展，特别是撇画，起笔要<b>‘高’</b>，连接紧密。",
                "做到了<b>‘上小下大’</b>，上面的口收紧，下面的肢体伸展，很生动。"
            ],
            "盏": [
                "上面的‘戋’字写得紧凑，两条横画<b>‘向右上倾斜’</b>，很有动感。",
                "最关键的斜钩写得<b>‘长而有弧度’</b>，像一把长戈，非常有力量。",
                "皿字底写得<b>‘扁宽’</b>，四竖画间距均匀，最后一长横稳稳托住了全字。"
            ],
            "笋": [
                "竹字头写得<b>‘端正稍扁’</b>，左右两边紧紧靠在一起，没有分家。",
                "下面的‘尹’字，长撇写得非常<b>‘舒展’</b>，向左下伸出，平衡了整个字。",
                "横折的横画和下面的短横保持了<b>‘平行’</b>，间距也很匀称。"
            ],
            "悬": [
                "上面的‘县’字横画很多，但你处理得很好，<b>‘间距均匀’</b>，没有写成黑疙瘩。",
                "心字底的卧钩写出了<b>‘弧度’</b>，像弯弯的月亮，稳稳托住了上面的‘县’。",
                "整体<b>‘上长下扁’</b>，虽然字很高，但重心很稳，没有倒。"
            ],
            "是": [
                "日字头写得<b>‘上宽下窄’</b>，呈倒梯形，位置居中。",
                "中间的长横写得<b>‘极长’</b>，一下子把整个字的架势拉开了。",
                "这个字的关键在于<b>‘中宫收紧，长横伸展’</b>，你抓住了这个精髓！"
            ],

            // === 三年级 第六课 (id:26) ===
            "蒸": [
                "中间的撇捺（横撇组合）写得非常<b>‘舒展’</b>，像手臂一样张开。",
                "草字头和四点底写得<b>‘扁平’</b>，把位置让给了中间。",
                "四点底的四个点<b>‘均匀分布’</b>，托住了上面的大车。"
            ],
            "等": [
                "竹字头和‘土’字都写得<b>‘扁平’</b>，给下面的‘寸’留出空间。",
                "中间‘土’字的那一横写得<b>‘特别长’</b>，是全字的主心骨。",
                "下面的‘寸’字，竖钩写得<b>‘垂直舒展’</b>，支撑起了整个字。"
            ],
            "急": [
                "上部写得<b>‘窄小’</b>，像个小脑袋，中间横折宽度控制得当。",
                "心字底的卧钩写得<b>‘极度舒展’</b>，像大盘子稳稳托住上面。",
                "整体<b>‘上紧下松’</b>，上面收得紧，下面放得开。"
            ],
            "章": [
                "立字头的第一横写得<b>‘长而平’</b>，盖住了下面的部分。",
                "中间的‘日’字写得<b>‘扁扁的’</b>，这是让字不显长的秘诀。",
                "最后一笔竖画是<b>‘悬针竖’</b>，垂直向下伸展，像定海神针。"
            ],
            "草": [
                "草字头和中间的‘日’都写得<b>‘窄而扁’</b>，收敛笔势。",
                "‘十’字的横画写得<b>‘非常长’</b>，向左右伸展，托住了上面。",
                "最后一竖<b>‘悬针利落’</b>，中轴对正，非常稳重。"
            ],
            "意": [
                "上面的‘立’和下面的‘心’比较宽，中间的‘日’写得<b>‘窄而扁’</b>。",
                "立字头的长横和心字底的卧钩<b>‘互相呼应’</b>，把字撑开了。",
                "心字底写得<b>‘扁宽’</b>，卧钩弧度优美，托举有力。"
            ],

            // === 三年级 第七课 (id:27) ===
            "历": [
                "厂字旁的横画短，撇画<b>‘长而弯’</b>，包围感很强。",
                "里面的‘力’字写得<b>‘精神’</b>，撇画和厂字旁的撇画方向一致，非常和谐。"
            ],
            "痕": [
                "病字旁写得真好，特别是撇画<b>‘舒展’</b>，护住了里面。",
                "里面的‘艮’字，最后一笔捺画<b>‘伸出框外’</b>，不仅平衡了重心，还让字看起来很透气。"
            ],
            "房_G3L27": [
                "户字头的点画<b>‘居中’</b>，下面的‘方’字写得端正。",
                "‘方’字的横折钩向内收，和户字头的撇画形成了<b>‘呼应’</b>。",
                "整体做到了<b>‘半藏半露’</b>，‘方’字没有完全缩进去，位置刚刚好。"
            ],
            "房": [
                "户字旁要写得<b>‘点高撇长’</b>。",
                "里面的‘方’字要<b>‘位置靠右’</b>，不要掉下来。"
            ],
            "武": [
                "这个字最难写的是‘戈’部的斜钩，你写得<b>‘长而有弧度’</b>，非常有力量。",
                "里面的‘止’字写得<b>‘靠上、靠左’</b>，给斜钩让出了位置，结构非常紧凑。",
                "注意：‘戈’部有一短撇，千万别漏掉哦！"
            ],
            "匀": [
                "包字头的撇画和横折钩配合得很好，框出了一个<b>‘方形’</b>的空间。",
                "里面的点和提写得<b>‘居中’</b>，没有碰到外框，显得很整洁。"
            ],
            "通": [
                "走之旁的捺画写得<b>‘一波三折’</b>，非常漂亮，稳稳托住了上面的‘甬’。",
                "上面的‘甬’字写得<b>‘修长’</b>，重心在一条垂线上，没有歪。",
                "你很好地处理了<b>‘笔顺’</b>，先写里面的‘甬’，再写外面的走之。"
            ],
            "翅": [
                "‘支’字旁的捺画写得<b>‘平而长’</b>，像翅膀一样展开，托住了右边的‘羽’。",
                "‘羽’字写得<b>‘轻盈’</b>，两个‘习’字高低错落，很有动感。"
            ],

            // === 三年级 第八课 (id:28) (v23.3 新增) ===
            "区_G3L28": [
                "区字框的上面一横写得<b>‘短’</b>，下面的一笔竖折写得<b>‘长’</b>，稳稳托住了里面的‘乂’。",
                "里面的‘乂’字，撇点交叉点<b>‘偏左’</b>，位置安排得很棒，没有掉出来。"
            ],
            "区": [
                "笔顺要记牢：<b>‘先横，再写里面，最后竖折’</b>。",
                "字形要写得<b>‘方正’</b>，不要写扁了。"
            ],
            "匠": [
                "你把‘斤’字写得<b>‘紧凑’</b>，紧紧贴住了左边的竖画。",
                "底部的横画向右<b>‘伸展’</b>，包住了上面的斤字。"
            ],
            "闲": [
                "门字框写得非常有精神，<b>‘左低右高’</b>，点画居中。",
                "里面的‘木’字写得<b>‘瘦长’</b>，为了避让门框，捺画变成了<b>‘点’</b>，非常高级的处理！"
            ],
            "凶": [
                "这个字是<b>‘先里后外’</b>。你先写了里面的‘乂’，再写外面的框，笔顺完全正确！",
                "里面的交叉点位置<b>‘居中’</b>，没有偏，显得字很正。"
            ],
            "幽": [
                "中间的竖画是<b>‘脊梁’</b>，写得直而长。",
                "两边的‘幺’字写得<b>‘小巧对称’</b>，像两扇窗户。"
            ],
            "困": [
                "大口框写得<b>‘方方正正’</b>，像个四合院。",
                "注意到了吗？为了不碰到框，‘木’字的撇捺写得<b>‘舒展但不出界’</b>，空间感很好。"
            ],

            // === 通用兜底 ===
            "default": [
                "笔画清晰，线条有力，基本功很扎实。",
                "结构完整，看起来很舒服，继续保持。",
                "这一笔一划都写得很到位，卷面整洁。"
            ]
        },
        closings: [
            "这种对结构的理解力，已经超过很多同学了！",
            "这一笔写出了书法的味道，继续保持这份专注。",
            "潘哒哒觉得你今天的字很有‘骨气’！",
            "写字如做人，堂堂正正，继续加油！",
            "真棒！我都想把这个字挂在墙上展示了！"
        ]
    };

    // ===== 2. 补充一、二年级评语（来自 class1.html / 1.26v1.html） =====
    // 2.1 补充结构类型（仅在主库没有该 key 时才加入）
    var EXTRA_STRUCT = {
        flat: [
            "很好地体现了<b>‘横长竖短’</b>的特点。",
            "整体字形<b>扁方稳重</b>，没有写得太瘦长。",
            "注意到了外框<b>‘上宽下窄’</b>的透视感，很专业。",
            "横向舒展，字形看起来非常稳固。"
        ],
        tall: [
            "完美抓住了<b>‘横短竖长’</b>的关键特征。",
            "字形<b>挺拔修长</b>，像个站军姿的小战士。",
            "竖画写得<b>垂直有力</b>，撑起了整个字的骨架。",
            "<b>‘竖长且直’</b>，看起来非常有精神。"
        ],
        leftSmall: [
            "左边的偏旁写得<b>小巧紧凑</b>，给右边留足了面子。",
            "<b>左窄右宽</b>的比例控制得很棒，很有层次。",
            "左边收紧，右边舒展，这就叫<b>‘避让’</b>。",
            "左边的关键笔画形态较小，没有喧宾夺主。"
        ],
        semi: [
            "走之底的折笔写得<b>小而精致</b>，没有把字撑散。",
            "内部的字坐得很稳，被走之底完美地<b>托住</b>了。",
            "包围关系处理得很好，结构紧凑而不拥挤。",
            "平捺舒展大气，底盘非常稳固。"
        ],
        obliqueHook: [
            "这一笔<b>横斜钩</b>写得非常舒展，像鸟儿展开的翅膀。",
            "整体结构虽然向右下倾斜，但<b>重心</b>找得很准。",
            "核心笔画<b>一笔写成</b>，中间没有断开，线条很有弹性。"
        ],
        speechRadical: [
            "言字旁写得<b>窄窄的、小小的</b>，符合‘避让’原则。",
            "言字旁<b>‘横斜竖直’</b>，提画干脆利落，很有精神。",
            "左窄右宽，里外配合得非常默契。"
        ],
        symmetry: [
            "左右两点的<b>位置很对称</b>，就像天平一样平衡。",
            "点画的位置安排得非常匀称，重心很稳。",
            "两个点写得<b>左低右高</b>，相互呼应，很活泼。"
        ],
        diagonal: [
            "把这两个点连起来看，刚好是一条漂亮的<b>斜线</b>。",
            "第一笔点很有分量，稳稳地压在了<b>竖中线</b>上。",
            "点画的大小变化控制得很好，<b>有大有小</b>，错落有致。"
        ],
        dotRules: [
            "点的<b>位置和形态</b>写得很准，起笔重收笔轻。",
            "注意到了点画的<b>大小变化</b>，非常有层次感。",
            "这一笔点，起到了画龙点睛的作用，把字提神了。",
            "点的位置非常考究，<b>遥相呼应</b>，结构紧凑。"
        ],
        flatPie: [
            "第一笔撇写得<b>短而平</b>，没有写成横，很专业！",
            "这个<b>平撇</b>写得很好，平缓而有力度。",
            "撇画短小精悍，为下面的笔画留出了空间。"
        ],
        slantPie: [
            "这个<b>斜撇</b>写得舒展大气，线条流畅。",
            "撇画<b>斜而长</b>，出锋锐利，很有气势。",
            "注意到了斜撇的形态，没有写得太弯，很直爽。"
        ],
        verticalPie: [
            "这个<b>竖撇</b>写得太标准了！<b>先直后弯</b>，下半段才自然弯出。",
            "注意到了吗？这一笔<b>不能直接写斜</b>，要先顿笔向下，再向左撇出。",
            "这一笔写得很有韧劲，像一棵被风吹弯的小树，<b>挺而不僵</b>。"
        ],
        flatNa: [
            "这个<b>平捺</b>写得真漂亮！就像一辆<b>小车</b>一样，稳稳地托住了上面的部分。",
            "注意到了吗？<b>平捺</b>要写出<b>‘一波三折’</b>的感觉，起伏很有节奏。",
            "笔顺完全正确！你是<b>先写右上部分</b>，再写左下的‘走之’，这就叫<b>先内后外</b>。"
        ],
        semiWrap: [
            "<b>先外后内</b>，笔顺完全正确！先把框搭好，再写里面的内容。",
            "左上包围的字，外面的框要写得<b>舒展</b>，把里面的字抱住。",
            "里面的字写得<b>居中平稳</b>，没有掉出来，结构很紧凑。"
        ]
    };

    Object.keys(EXTRA_STRUCT).forEach(function (k) {
        if (!window.COMMENT_DB.structure[k]) {
            window.COMMENT_DB.structure[k] = EXTRA_STRUCT[k];
        }
    });

    // 2.2 补充一、二年级单字精讲（只在当前没有该 key 时才加入）
    // 来自 class1.html
    var EXTRA_DETAILS_G1 = {
        "春": ["上面的三笔<b>短横</b>间距均匀，没有粘连。", "下面的‘日’写出了<b>‘竖长且直’</b>的感觉。", "撇捺舒展，像春天的树枝一样伸开了。"],
        "青": ["上半部分的<b>横画</b>平稳有力，很精神。", "下面的‘月’字第一笔<b>竖撇</b>先直后弯，很标准。", "上下两部分垂直对正，重心很稳。"],
        "当": ["最上面的<b>短竖</b>写得‘短而直’，立在正中间。", "中间的小短横写得很紧凑，没有松散。", "底部的<b>横折</b>像地基一样稳稳托住了上面。"],
        "共": ["中间两竖写出了<b>左短右长</b>的变化，非常专业！", "底部的两点撑开得刚刚好，稳固又舒展。", "整体上紧下松，非常有层次感。"],
        "元": ["这个<b>竖弯钩</b>圆润饱满，钩尖向上有力。", "第二笔长横略微倾斜，让字动感十足。", "上窄下宽，‘二’字头和‘儿’字底配合默契。"],
        "止": ["第一笔<b>短竖</b>稳稳站在竖中线上，定好了主心骨。", "最后一笔长横平稳舒展，起收有顿挫。", "虽然笔画少，但间架结构撑得很满。"],
        "他": ["单人旁的<b>撇</b>短而有力，没有影响右边。", "右边的竖弯钩向外延伸，提起了精气神。", "左右避让处理得很好，左窄右宽。"],
        "回": ["写出了<b>‘横长竖短’</b>的特点，且竖画微微<b>向里斜</b>。", "外框呈倒梯形，上宽下窄，非常稳固。", "内口居中悬空，留白非常均匀。"],
        "日": ["抓住了<b>‘横短、竖长且直’</b>的特征，很有精神。", "两侧竖画像柱子一样笔直，骨力通达。", "中间短横<b>靠左不靠右</b>，留出了气口。"],
        "目": ["<b>‘横短、竖长且直’</b>，字形挺拔修长。", "中间两横间距均匀，像梯子一样整齐。", "多而不乱，每一笔都安排得井井有条。"],
        "自": ["第一笔<b>平撇</b>写得‘短而平’，不抢风头。", "下半部分保持了<b>‘竖长且直’</b>的特点，没有写歪。", "上面的撇给整个字定了很好的中轴线。"],
        "田": ["写出了<b>‘竖往里斜’</b>的透视感，很有立体感。", "中间‘十’字交汇在<b>田字格正中心</b>，找点很准！", "上下左右空间分割匀称，体现了对称美。"],
        "四": ["特别表扬！里面的<b>‘竖弯’</b>没有写成钩，观察真仔细。", "字形呈<b>扁方形</b>，外框宽绰不拥挤。", "竖弯转弯处圆润流畅，线条很美。"],
        "白": ["第一笔<b>撇</b>起笔在竖中线上，定好了重心。", "下面的框依然保持了<b>‘横长折短’</b>的宽扁趋势。", "整体上宽下窄，看起来轻盈又稳当。"],
        "没": ["第五笔<b>横折弯</b>写得很好，‘折处稍顿，弯处不顿’。", "<b>横折弯</b>形态控制得小巧，给右边留足了空间。", "特别表扬！这个弯是圆转的，而且<b>没有钩</b>！"],
        "造": ["里面的‘告’字坐得很稳，被下面的<b>平捺</b>完美地<b>托住</b>了。", "先写完‘告’，再写走之底，笔顺规则掌握得很好！", "最后的<b>平捺</b>略向右下平缓行笔，托住了整个字。"],
        "远": ["<b>平捺</b>向右延伸得很长，像小船一样载着上面的‘元’字。", "右上部分的‘元’写得高高的，给走之底留出了通过的道路。", "竖弯钩没有掉下来，被完美接住了。"],
        "队": ["左耳旁的<b>横撇弯钩</b>衔接得轻巧自然，一气呵成。", "左边的耳朵旁写得<b>窄窄的</b>，位置偏高，很精神。", "右边的撇捺舒展，和左边的紧凑形成鲜明对比。"],
        "朵": ["注意！上面的‘几’是<b>横折弯钩</b>，你写出了钩，没搞混！", "转弯的地方圆润流畅，<b>不滞涩</b>，出钩很快。", "上面宽扁，下面稳重，<b>上宽下窄</b>重心很稳。"],
        "运": ["里面的‘云’字居中偏上，<b>撇折</b>的角度找得很准。", "走之底的<b>横折折撇</b>一笔写成，线条流畅。", "平捺向右延伸得很长，展现了汉字的<b>流动美</b>。"],
        "飞": ["第一笔<b>横斜钩</b>写得真好，弧度刚刚好。", "横斜钩向<b>右下伸展</b>得很到位，包住了整个字。", "没有写成‘横折弯钩’，转弯处是<b>圆润</b>。"],
        "气": ["最后一笔<b>横斜钩</b>把上面的部分托住了，非常有力量。", "撇画短小精悍，和下面的长钩形成了<b>长短对比</b>。", "中间的三横排列得紧凑均匀，很有<b>精气神</b>。"],
        "请": ["言字旁的<b>横折提</b>写得‘横斜竖直’，形态窄小。", "右边的‘青’字<b>横画平行</b>，间距均匀。", "左右结构紧凑，言字旁紧贴着右边。"],
        "证": ["言字旁的第一笔<b>点</b>，位置准确，起笔稍重。", "右边的‘正’字写得<b>竖直挺拔</b>，支撑起了重心。", "最后一横写得平稳，封住了底，稳如泰山。"],
        "识": ["言字旁写得<b>高而窄</b>，右边高低错落很有美感。", "‘口’字的<b>封口横</b>没有漏掉，结构完整！", "最后一笔<b>长点</b>写得很有质感，压住了阵脚。"],
        "认": ["这个<b>斜撇</b>写得好！斜而长，尾巴尖尖，很有气势。", "撇低捺高，捺脚写出了<b>‘一波三折’</b>。", "言字旁没有写太大，把位置让给了右边，比例完美。"],
        "让": ["右边的‘上’字<b>竖画挺拔</b>，第一笔竖立得住。", "言字旁的高低位置控制得很好，与右边底部齐平。", "右边的短横没有戳到言字旁，<b>穿插避让</b>做得很好。", "言字旁的点是<b>右点</b>，写在<b>左上方</b>，位置找得很准。"],
        "尖": ["上面的‘小’字头，<b>左右两点对称</b>，看起来很舒服。", "上小下大，上窄下宽，站得很稳。", "左边的点是<b>左点</b>，略向左下行笔，很有质感。"],
        "米": ["注意到了第一笔是<b>右点</b>，写在左上方，观察真仔细！", "撇捺像裙子一样散开，支撑有力。", "四面的点画向中心聚拢，<b>‘中宫收紧’</b>很有精神。"],
        "广": ["第一笔<b>右点</b>写在<b>正上方</b>，不宜过大，像个小帽子。", "横画不宜过长，撇画舒展，<b>广字头</b>写得很大气。", "撇画舒展包围，体现了<b>半包围结构</b>的稳定感。"],
        "为": ["第一笔点和最后一笔点，<b>遥相呼应</b>，动感十足！", "中间的<b>横折钩</b>气势很足，钩尖指向圆心。", "撇画伸展，穿插在两点之间，结构非常紧凑。"],
        "外": ["右边的点写得<b>比左边的大</b>，大小变化注意到了，真棒！", "左边撇画收敛，把位置让给了右边，<b>左窄右宽</b>。", "右边的点是<b>右点</b>，向右下行笔，收笔圆润。"],
        "兴": ["上面的三个点，<b>中间高两边低</b>，很有节奏感。", "下面的长横稳稳托住了上面的点，<b>上紧下松</b>。", "最后一笔变成了<b>长点</b>（反捺），支撑起了整个字。"],
        "平": ["中间的两个点画，<b>左小右大</b>，很有层次。", "长横写得平稳舒展，真的写得很‘平’！", "竖画垂直有力，压在<b>竖中线</b>上，是整个字的脊梁。"],
        "沙": ["注意到了吗？<b>第一、二笔点略小，第六笔右点略大</b>，层次分明！", "左边的三点水呈<b>弧形排列</b>，非常生动。", "右边的‘少’字撇画舒展，最后一笔点压住了阵脚。"],
        "方": ["第一笔也是<b>先写右点</b>，居于正上方，头正身直。", "<b>横折钩</b>略微向内收，重心聚拢在中间，没有散架。", "注意到了<b>‘点’不宜过大</b>，结构很清秀。"],
        "千": ["第一笔是<b>平撇</b>，写得<b>平而短</b>，尾巴尖尖的，靠上面。", "竖画悬针出锋，写得<b>直而长</b>，支撑有力。", "<b>独体字</b>写得舒展大方，把田字格撑得刚刚好。"],
        "禾": ["上面的<b>平撇</b>短小精悍，为下面的笔画留出了空间。", "撇捺舒展，像禾苗的叶子一样张开。", "上面的平撇和下面的横画之间留有<b>呼吸感</b>。"],
        "从": ["左边的‘人’是跟班，捺变成了<b>点</b>；右边的‘人’是主角，斜撇舒展。", "右边的‘人’撇画舒展，捺脚分明。", "一宽一窄，一前一后，这就叫<b>避让</b>。"],
        "胡": ["右边‘月’字的<b>竖撇稍长</b>，你写出了这种修长的美感。", "左边的‘古’字写得小巧，给右边的‘月’腾出了位置，<b>左右避让</b>做得很好。", "‘月’字中间的短横间距均匀，没有粘连。"],
        "讲": ["右边‘井’字的<b>竖撇写得挺直</b>，而且短一些，非常干脆利落。", "言字旁提画有力，右边的‘井’字横平竖直，整个字<b>精气神十足</b>。", "这一笔竖撇没有写太长，给下面的竖画留足了面子。"],
        "开": ["特别表扬！你没有把第三笔写成斜撇，而是标准的<b>竖撇</b>，观察真仔细。", "两横<b>上短下长</b>，底部的竖画悬针出锋，立地顶天。", "整个字写得非常舒展，把田字格撑得刚刚好。"],
        "用": ["第一笔<b>竖撇略有弧度</b>，像一把弯刀，很有弹性。", "外框写得<b>方方正正</b>，‘用’字肚量大，里面内容安排得匀称。", "横折钩的折角清晰有力，竖画垂直。"],
        "月": ["第一笔是<b>竖撇</b>，<b>先直后弯</b>，收笔出尖，写得非常有质感。", "字形瘦瘦长长的，像一弯新月挂在天空。", "中间两短横<b>靠左不靠右</b>，留出了气口，很透气。"],
        "皮": ["第二笔是<b>竖撇</b>，第四笔是<b>横撇</b>，两个撇的方向和长短你都分清了，真棒！", "横钩写得轻快，撇捺舒展，像在跳舞一样灵动。", "捺脚写得平稳，把整个字稳稳地托住了。"],
        "井": ["和‘讲’字一样，这个<b>竖撇要挺直</b>，不能太弯，你做到了。", "两横一撇一竖，间架结构非常匀称，重心很稳。", "最后一笔长竖垂直有力，是整个字的脊梁。"],
        "之": ["<b>点居中</b>，横画短且向上挑，给下面的捺留出了起笔空间。", "这一笔<b>平捺</b>写出了‘一波三折’的韵味，非常舒展。", "虽然是独体字，但间架结构安排得非常匀称。"],
        "近": ["里面的‘斤’字写得挺拔，<b>平撇</b>短小，不跟走之底打架。", "走之底的<b>平捺</b>略向右下平缓行笔，收笔出尖，很利落。", "先内后外，笔顺完全正确。"],
        "还": ["里面的‘不’字重心很稳，没有倒，<b>平捺</b>起到了关键的支撑作用。", "捺脚处横向带笔出尖，像滑滑梯最后那一下，很顺畅。", "走之底没有写得太大，包住了里面的字。"],
        "过": ["里面的‘寸’字点画位置准确，走之底包裹得刚刚好。", "这一笔<b>平捺</b>写得非常有弹性，托住了整个字的重量。", "横折钩写得有力度，钩尖向上。"],
        "左": ["写出了<b>‘横短撇长’</b>的特点，撇画伸展得很长。", "<b>最后写‘工’</b>，笔顺完全正确，先写外面的横撇。", "‘工’字稳稳地坐在了撇画的下放，重心很稳。"],
        "右": ["这一个字变成了<b>‘横长撇短’</b>，长横写得非常有气势！", "下面的<b>‘口’写得略小</b>，和上面的长横形成了鲜明的对比。", "第一笔是撇，第二笔是横，起笔顺序没有搞混，真棒！"],
        "石": ["和‘左’字一样，这里也是<b>‘横短撇长’</b>，撇画从右上向左下舒展。", "下面的<b>‘口’写得略大</b>，稳稳地托住了上半部分。", "横画起笔稍轻，收笔稍重，很有质感。"],
        "有": ["很好地体现了<b>‘横长撇短’</b>的特征，长横像屋顶一样盖住了下面。", "特别表扬！<b>第三笔写的是‘竖’</b>，没有写成撇，观察真仔细！", "下面的‘月’字两横匀称，字形瘦长。"],
        "包": ["符合<b>先外后内</b>的笔顺规则，先写勺子头，再写里面的‘巳’。", "里面的<b>竖弯钩</b>向右舒展，圆润有力，把整个字撑起来了。", "外面的包围框没有写得太小，给里面留足了空间。"],
        "饱": ["加上了食字旁，右边的‘包’字<b>变窄了</b>，给左边留出了位置。", "左窄右宽，食字旁的撇画和右边的包配合默契，没有打架。", "右边的竖弯钩依然很舒展，把字托住了。"],
        "抱": ["提手旁昂首挺胸，右边的‘包’字<b>字形收窄</b>，显得很精神。", "提手旁的提画有力，右边的竖弯钩依然保持了舒展，刚柔并济。", "左右两部分紧紧抱在一起，结构很紧凑。"]
    };

    Object.keys(EXTRA_DETAILS_G1).forEach(function (k) {
        if (!window.COMMENT_DB.details[k]) {
            window.COMMENT_DB.details[k] = EXTRA_DETAILS_G1[k];
        }
    });

    // 来自 1.26v1.html：主要补充二年级同字不同评的 key（例如包_G2L17）
    var EXTRA_DETAILS_G2 = {
        "言": ["第一点<b>‘居中靠上’</b>，起笔很有分量。", "中间长横平稳，<b>‘主笔突出’</b>。"],
        "宇": ["宝盖头写得宽敞，<b>‘上宽盖下’</b>。", "第一点和下面的竖钩<b>‘点竖相对’</b>，重心很稳。", "里面的‘于’字横画<b>‘间距均匀’</b>。"],
        "室": ["宝盖头宽敞，<b>‘钩指向字心’</b>。", "第一点和下中心<b>‘点竖相对’</b>。"],
        "突": ["穴宝盖两点<b>‘向内收紧’</b>。", "下‘犬’撇捺舒展，<b>‘下托上’</b>。"],
        "穷": ["穴宝盖宽，<b>‘上宽下窄’</b>。", "‘力’字撇画<b>‘舒展有势’</b>。"],
        "雷": ["雨字头四点<b>‘指向字心’</b>。", "下‘田’小巧，<b>‘上大下小’</b>。"],
        "蛙": ["虫字旁口<b>扁且靠上</b>。", "竖画<b>起笔高</b>。", "提画<b>左伸右缩</b>。", "右边‘圭’横画<b>匀称</b>。"],
        "轮": ["车字旁<b>窄长</b>。", "短横<b>上斜</b>，动感十足。", "<b>先竖后提</b>，笔顺正确。", "右边‘仑’撇画<b>穿插</b>。"],
        "转": ["车字旁<b>挺拔</b>。", "提画<b>向左伸展</b>。", "右边‘专’<b>竖折撇</b>流畅。", "点画<b>靠上</b>重心稳。"],
        "痛": ["病字旁<b>首点居中</b>。", "撇画<b>写长</b>，左包右。", "点提<b>紧靠</b>。", "内部‘甬’<b>向右探出</b>。"],
        "疲": ["病字旁<b>左长撇</b>包住。", "点画有力，气脉连贯。", "内部‘皮’横钩<b>长而平直</b>。", "整体<b>内外相称</b>。"],
        "包_G2L17": ["第一笔撇<b>稍立靠左</b>。", "竖<b>向里包裹</b>。", "内部‘巳’<b>偏左</b>。", "内外<b>大小适当</b>。"],
        "峡": ["山字旁窄小，<b>‘中竖较高’</b>。", "三竖<b>‘间距均匀’</b>。", "右边‘夹’字注意了<b>穿插</b>。"],
        "破": ["石字旁修长，<b>‘口’字写扁</b>。", "撇画短而有力。", "右边横钩<b>长而平直</b>。"],
        "砍": ["石字旁横撇短，<b>‘左窄右宽’</b>。", "右边‘欠’字<b>‘两撇不同’</b>。", "捺画起笔高，结构紧凑。"],
        "特": ["牛字旁<b>‘窄长’</b>。", "<b>‘提左伸’</b>平衡右边。", "右边‘寺’字<b>‘间距均匀’</b>。"],
        "物": ["牛字旁<b>提不穿竖</b>。", "右边‘勿’字撇画从容。", "左右两部分<b>‘齐平’</b>。"],
        "船": ["舟字旁<b>‘两撇不同’</b>。", "<b>‘提左伸不过右竖’</b>。", "整体<b>‘左长右短’</b>。"],
        "感": ["心字底<b>‘卧钩’</b>平卧。", "心字底<b>三点间距均匀</b>。", "上部收敛，<b>‘上紧下松’</b>。"],
        "热": ["四点底<b>‘一点朝左，三点向右’</b>。", "中间两点小，<b>‘首尾大中间小’</b>。", "<b>‘下宽托上’</b>。"],
        "黑": ["四点底<b>‘间距均匀’</b>。", "四个点写得<b>灵动</b>。", "上部<b>‘横画等距’</b>。"],
        "盖": ["皿字底<b>‘字底形状扁’</b>。", "最下长横<b>‘下宽托上’</b>。", "上部‘羊’字<b>‘框窄土收缩’</b>。"],
        "异": ["下长横<b>‘画舒展’</b>。", "上‘巳’字<b>‘头小’</b>。", "封口闭合得好。"],
        "弄": ["底横长而平稳，<b>‘下宽托上’</b>。", "竖撇略外张，增加<b>稳定性</b>。", "上下<b>‘中心对正’</b>。"],
        "国": ["国字框方正，<b>‘长方形’</b>。", "左竖短右折长，<b>‘左短右长’</b>。", "内部<b>‘内部开阔’</b>。", "<b>‘字框居中’</b>。"],
        "同": ["左右两竖<b>挺直</b>。", "横折钩钩尖向上。", "内部<b>‘内部靠上偏左’</b>。", "<b>间距均匀</b>。"],
        "网": ["同字框<b>‘左右竖挺直’</b>。", "<b>‘左短右长’</b>。", "内部匀称，<b>‘内部开阔’</b>。", "内部<b>‘稍靠上’</b>。"],
        "闭": ["门字框<b>‘左右竖挺直’</b>。", "左点不连横，<b>‘内外相称’</b>。", "内部<b>‘内部稍靠上’</b>。", "竖钩直，<b>‘内部开阔’</b>。"],
        "臣": ["三框<b>‘上横上扬’</b>。", "底横<b>‘下横平稳’</b>。", "中间<b>‘间距均匀’</b>。", "外框<b>‘看里面’</b>。"],
        "财": ["整体结构<b>左窄右宽</b>。", "右边‘才’撇画<b>插到</b>贝字旁下方。", "贝字旁最后一点<b>收敛</b>。"],
        "贴": ["贝字旁<b>不宜大</b>。", "口字<b>扁扁的</b>。", "左右结合紧密。"],
        "饭": ["<b>底部齐平</b>。", "食字旁<b>撇画左伸</b>。", "右边‘反’撇<b>注意穿插</b>。"],
        "鸭": ["左边‘甲’字<b>窄窄的</b>。", "‘鸟’字<b>“头小身子大”</b>。", "左短右长，错落有致。"],
        "收": ["左边竖提<b>挺拔</b>。", "反文旁<b>捺要伸展</b>。", "形成了<b>“左收右放”</b>的节奏感。"],
        "暖": ["日字旁<b>窄小且靠上</b>。", "右边捺画<b>开张</b>。"],
        "昨": ["日字旁两竖<b>垂直</b>。", "右边<b>长横穿插</b>。"],
        "眼": ["目字旁<b>瘦长靠上</b>。", "右边<b>竖提挺拔</b>。"],
        "乱": ["舌字旁<b>横向左伸</b>。", "右边<b>竖弯钩舒展</b>。", "<b>左低右高</b>。"],
        "欢": ["又字旁<b>靠上</b>，捺变长点。", "右边<b>舒展大方</b>。"],
        "观": ["又字旁<b>横撇短</b>。", "右边<b>竖弯钩伸展</b>。"],
        "愿": ["笔画<b>繁而不乱</b>。", "<b>卧钩</b>平稳。"],
        "底": ["这一笔<b>斜钩</b>写得太漂亮了！", "左撇右钩，<b>舒展大方</b>。"],
        "居": ["尸字头<b>头小撇长</b>。", "内部‘古’字<b>略微偏右</b>。"],
        "原": ["厂字旁横画<b>短且上斜</b>。", "内部<b>上宽下窄</b>。"],
        "扇": ["内部<b>左低右高</b>。", "四点<b>灵动</b>。"]
    };

    Object.keys(EXTRA_DETAILS_G2).forEach(function (k) {
        if (!window.COMMENT_DB.details[k]) {
            window.COMMENT_DB.details[k] = EXTRA_DETAILS_G2[k];
        }
    });

    // ===== 3. 统一的智能评语生成函数 =====
    // 供 class1.html / 1.26v1.html / class3.html 共同调用
    window.generateSmartComment = function () {
        var duration = (Date.now() - (window.startTime || 0));
        var speedType = 'normal';
        if (duration < 8000) speedType = 'fast';
        if (duration > 30000) speedType = 'slow';

        if (typeof window.COMMENT_DB === 'undefined') {
            var elFallback = document.getElementById('ai-comment');
            if (elFallback) {
                elFallback.innerHTML = "网络开小差了，没加载到评语库... 🐼";
            }
            return;
        }

        var DB = window.COMMENT_DB;

        // 开头：根据速度
        var openList = DB.openings[speedType] || DB.openings.normal;
        var opening = openList[Math.floor(Math.random() * openList.length)];

        // 单字精讲：支持 “同字不同评”
        var charKey = window.currentActiveChar && window.currentActiveChar.char;
        var course = window.currentActiveCourse || {};
        var detailList = DB.details[charKey] || DB.details["default"];

        // 优先使用带年级+课次的专用 key，例如 包_G2L17 / 放_G3L23
        if (charKey && course.grade && course.id) {
            var specificKey = charKey + "_G" + course.grade + "L" + course.id;
            if (DB.details[specificKey]) {
                detailList = DB.details[specificKey];
            }
        }
        var techDetail = detailList[Math.floor(Math.random() * detailList.length)];

        // 结构点评
        var structureInfo = "";
        var currentLessonIdNum = course.id;
        var structType = "general";

        // 一年级字形分类（老逻辑保留）
        var flatChars = ["回", "四", "田", "白", "春", "共", "元"];
        var tallChars = ["日", "目", "自", "青", "止", "他", "当"];
        var leftSmallChars = ["没", "队"];
        var semiChars = ["造", "远", "运"];
        var obliqueHookChars = ["飞", "气"];
        var speechChars = ["请", "证", "识", "认", "让"];
        var symmetryChars = ["尖", "米", "平"];
        var diagonalChars = ["广", "为", "外", "兴"];
        var flatPieChars = ["千", "禾"];
        var slantPieChars = ["认", "从"];
        var verticalPieChars = ["胡", "讲", "开", "用", "月", "皮", "井"];
        var flatNaChars = ["之", "造", "远", "近", "还", "过"];
        var semiWrapChars = ["包", "饱", "抱"];

        if (course.grade === 2) {
            // 二年级结构逻辑
            if (course.id === 11) structType = "leftUpperWrap";
            else if (course.id === 12) {
                if (charKey === "乱") structType = "leftRight_lowHigh";
                else structType = "leftRight_narrowWide";
            }
            else if (course.id === 13) {
                if (charKey === "放") structType = "leftRight_equal";
                else structType = "leftRight_interlace";
            }
            else if (course.id === 14) {
                if (charKey === "闭") structType = "surround_men";
                else if (charKey === "臣") structType = "surround_san";
                else structType = "surround_guo";
            }
            else if (course.id === 15) structType = "upDown_wideBottom";
            else if (course.id === 16) structType = "leftRight_narrowLong";
            else if (course.id === 17) {
                if (charKey === "蛙" || charKey === "轮" || charKey === "转") structType = "leftRight_narrowAvoid";
                else if (charKey === "痛" || charKey === "疲") structType = "surround_leftUp_bing";
                else if (charKey === "包") structType = "surround_bao";
            }
            else if (course.id === 18) structType = "upDown_cover";
        } else if (course.grade === 3) {
            // 三年级结构逻辑
            if (course.id === 21) {
                if (charKey === "杉" || charKey === "影") structType = "three_pie";
                else if (charKey === "欧" || charKey === "欣") structType = "qian_zi";
                else if (charKey === "预" || charKey === "颗") structType = "ye_zi";
            }
            else if (course.id === 22) {
                if (charKey === "孔" || charKey === "孤") structType = "zi_zi";
                else if (charKey === "弹" || charKey === "引") structType = "gong_zi";
                else if (charKey === "验" || charKey === "骗") structType = "ma_zi";
            }
            else if (course.id === 23) {
                if (charKey === "配" || charKey === "酷") structType = "you_zi";
                else if (charKey === "粒" || charKey === "料") structType = "mi_zi";
                else if (charKey === "放" || charKey === "施") structType = "fang_zi";
            }
            else if (course.id === 24) {
                if (["泰", "奉", "拳", "眷"].includes(charKey)) structType = "chun_zi";
                else if (charKey === "爹" || charKey === "斧") structType = "fu_zi";
            }
            else if (course.id === 25) {
                if (charKey === "夺" || charKey === "是") structType = "upDown_wideTop";
                else if (charKey === "吴" || charKey === "悬") structType = "upDown_wideBottom";
                else if (charKey === "盏" || charKey === "笋") structType = "upDown_skew";
            }
            else if (course.id === 26) {
                if (charKey === "蒸") structType = "upMidDown_wideMid";
                else if (charKey === "等" || charKey === "草") structType = "upMidDown_wideBottom";
                else if (charKey === "章") structType = "upMidDown_wideTop";
                else if (charKey === "急") structType = "upMidDown_equal";
                else if (charKey === "意") structType = "upMidDown_wideEnds";
            }
            else if (course.id === 27) {
                if (["历", "痕", "房"].includes(charKey)) structType = "surround_leftUp_G3";
                else if (["武", "匀"].includes(charKey)) structType = "surround_rightUp_G3";
                else if (["通", "翅"].includes(charKey)) structType = "surround_leftDown_G3";
            }
            else if (course.id === 28) {
                if (["区", "匠"].includes(charKey)) structType = "surround_left3_G3";
                else if (charKey === "闲") structType = "surround_top3_G3";
                else if (charKey === "凶" || charKey === "幽") structType = "surround_bottom3_G3";
                else if (charKey === "困") structType = "surround_full_G3";
            }
        } else {
            // 一年级兜底结构逻辑
            if (currentLessonIdNum === 7 && flatPieChars.includes(charKey)) structType = "flatPie";
            else if (currentLessonIdNum === 7 && slantPieChars.includes(charKey)) structType = "slantPie";
            else if (currentLessonIdNum === 8 && verticalPieChars.includes(charKey)) structType = "verticalPie";
            else if (currentLessonIdNum === 9 && flatNaChars.includes(charKey)) structType = "flatNa";
            else if (currentLessonIdNum === 10 && semiWrapChars.includes(charKey)) structType = "semiWrap";
            else {
                if (flatChars.includes(charKey)) structType = "flat";
                else if (tallChars.includes(charKey)) structType = "tall";
                else if (leftSmallChars.includes(charKey)) structType = "leftSmall";
                else if (semiChars.includes(charKey)) structType = "semi";
                else if (obliqueHookChars.includes(charKey)) structType = "obliqueHook";
                else if (speechChars.includes(charKey)) structType = "speechRadical";
                else if (symmetryChars.includes(charKey)) structType = "symmetry";
                else if (diagonalChars.includes(charKey)) structType = "diagonal";
            }
        }

        if (Math.random() > 0.3) {
            var structList = DB.structure[structType] || DB.structure["general"];
            structureInfo = structList[Math.floor(Math.random() * structList.length)];
        }

        var closingList = DB.closings || [];
        var closing = closingList[Math.floor(Math.random() * closingList.length)] || "";

        var finalComment = opening + techDetail + (structureInfo ? " " + structureInfo : "") + " " + closing;
        var el = document.getElementById('ai-comment');
        if (el) el.innerHTML = finalComment;
    };
})();

